$(document).ready(function () {
    $('#dg{{n}}_reload').bind('click', function () {
        load_dg{{n}}();
    });
    {% if (dg_inline==0) %}
    $('#dg{{n}}_insert').bind('click', function () {
        dg{{n}}_edit_form('insert');
    });
    {% endif %}
    $('#dg1_export').bind('click', function () {
        JSONToCSVConvertor($('#dg{{n}}').datagrid('getRows'), "{{T('dati')}}", 'label')
    });
    function load_dg{{n}}() {
        //$('#tt').tabs('select', 'Tab{{n}}');
        $('#dg{{n}}').datagrid('uncheckAll');
        $('#dg{{n}}').datagrid('disableFilter');
        $('#dg{{n}}').edatagrid({
            border: false,
            toolbar: '#tb{{n}}',
            title: '{{title}}',
            url: '{{host_api}}{{api_url}}/SELECT',
            {% if (dg_inline==1) %}
            saveUrl: '{{host_api}}{{api_url}}/INSERT',
            updateUrl: '{{host_api}}{{api_url}}/UPDATE',
            {% endif %}
            destroyUrl: '{{host_api}}{{api_url}}/DELETE',
            method: 'post',
            rownumbers: true,
            striped: true,
            fit: true,
            idField: '{{pk|raw}}', /** {{T('importante')}} **/
            singleSelect: true,
            checkOnSelect: false,
            selectOnCheck: false,
            remoteSort: false,
            multiSort: false,
            autoRowHeight: false, //For Speed refresh
            {{pagination|raw}}
            destroyMsg: {
                norecord: {// when no record is selected
                    title: "{{T('Attenzione')}}",
                    msg: "{{T('Non Ã¨ stata selezionata nessuna riga')}}"
                },
                confirm: {// when select a row
                    title: "{{T('Conferma')}}",
                    msg: "{{T('Sei sicuro di voler cancellare?')}}"
                }
            },
            onError: function (index, row) {
                $.messager.alert("{{T('Contattare assistenza')}}", row.msg, 'error');
                },
            {{on_after_edit|raw}}
            {% if (dg_inline==0) %}
            onDblClickRow: function (index, row) {
                dg{{n}}_edit_form('update');
            },
            {% endif %}
                {#
                columns: [[
                    {field: 'SEQ', title: 'Ord', width: '25px', editor: {type: 'numberbox', options: {required: true}}, sortable: true},
                    {field: 'DTIN', title: 'Data Inizio', width: 90, editor: {type: 'datebox', options: {formatter: myformatter_d_it, parser: myparser_d_it, required: true}}, sortable: true},
                    {field: 'DTFI', title: 'Data Fine', width: 90, editor: {type: 'datebox', options: {formatter: myformatter_d_it, parser: myparser_d_it, required: true}}, sortable: true},
                    {field: 'ID_CLONE', title: 'Fase<br>Duplicata', formatter: mycheck},
                ]],
                #}
                {{col_crud|raw}}
                });
        $('#dg{{n}}').datagrid('enableFilter');
    }

    load_dg{{n}}();
    {{fn_dg_edit_form|raw}}
});
